/*****************************************************************
** 功能描述:该程序对CF12864液晶模块进行初始化并开启显示字符
*****************************************************************/ 
#include "DSP281x_Device.h"
long int i = 0;
Uint16 J=0; 
Uint16 mov=0xc0;//改变mov值实现滚屏
#define	 LCD_CSA  GpioDataRegs.GPEDAT.all = 0xfffc; //CSA=0,CSB=1片选左屏幕
#define	 LCD_CSB  GpioDataRegs.GPEDAT.all = 0xfffd; //CSA=1,CSB=0片选右屏幕
#define	 LCD_SW   GpioDataRegs.GPBDAT.bit.GPIOB7  //LED背光，低有效
#define	 LCD_DI   GpioDataRegs.GPADAT.bit.GPIOA13 //指令/数据，低为数据
#define	 LCD_RW   GpioDataRegs.GPADAT.bit.GPIOA14 //读/写，低为写
#define	 LCD_E    GpioDataRegs.GPADAT.bit.GPIOA15 //使能信号高电平有效，下降沿锁定数据
void IOinit() // I/O初始化子程序
{
 	EALLOW;
 	//GPIOA13~A15配置为普通I/O口输出 
    GpioMuxRegs.GPAMUX.all = GpioMuxRegs.GPAMUX.all&0x1fff;
	GpioMuxRegs.GPADIR.all = GpioMuxRegs.GPADIR.all|0xe000;
	//GPIOB7     配置为普通I/O口输出 
    GpioMuxRegs.GPBMUX.bit.T4PWM_GPIOB7 = 0;
	GpioMuxRegs.GPBDIR.bit.GPIOB7= 1;
	//GPIOE0~E2  配梦一般I/O口输出,作138译码  
 	GpioMuxRegs.GPEMUX.all = GpioMuxRegs.GPEMUX.all&0xfff8; 
	GpioMuxRegs.GPEDIR.all = GpioMuxRegs.GPEDIR.all|0x0007;
	//GPIOB8~B15 配置为一般I/O口,作数据线D0~D7
	GpioMuxRegs.GPBMUX.all = GpioMuxRegs.GPBMUX.all&0x00ff;
	EDIS;			
}
//以下点阵生成通过字模软件采用纵向取模、字节倒序的方法获得，
//宋体12; 对应的点阵为：宽x高=16x16 
char table1[2000]={       
/*--  文字:  数  --*/
/*--  宋体12;  此字体下对应的点阵为：宽x高=16x16   --*/
0x10,0x92,0x54,0x38,0xFF,0x38,0x54,0x52,0x80,0xF0,0x1F,0x12,0x10,0xF0,0x10,0x00,
0x42,0x42,0x2A,0x2E,0x13,0x1A,0x26,0x02,0x40,0x20,0x13,0x0C,0x33,0x60,0x20,0x00,

/*--  文字:  字  --*/
/*--  宋体12;  此字体下对应的点阵为：宽x高=16x16   --*/
0x00,0x10,0x0C,0x24,0x24,0x24,0x25,0x26,0xA4,0x64,0x24,0x04,0x14,0x0C,0x00,0x00,
0x00,0x02,0x02,0x02,0x02,0x42,0x82,0x7F,0x02,0x02,0x02,0x02,0x02,0x02,0x02,0x00,

/*--  文字:  信  --*/
/*--  宋体12;  此字体下对应的点阵为：宽x高=16x16   --*/
0x80,0x40,0x30,0xFC,0x07,0x0A,0xA8,0xA8,0xA9,0xAE,0xAA,0xA8,0xA8,0x08,0x08,0x00,
0x00,0x00,0x00,0x7F,0x00,0x00,0x7E,0x22,0x22,0x22,0x22,0x22,0x7E,0x00,0x00,0x00,

/*--  文字:  号  --*/
/*--  宋体12;  此字体下对应的点阵为：宽x高=16x16   --*/
0x40,0x40,0x40,0x5F,0xD1,0x51,0x51,0x51,0x51,0x51,0x51,0x5F,0x40,0x40,0x40,0x00,
0x00,0x00,0x00,0x02,0x07,0x02,0x02,0x22,0x42,0x82,0x42,0x3E,0x00,0x00,0x00,0x00,

/*--  文字:  处  --*/
/*--  宋体12;  此字体下对应的点阵为：宽x高=16x16   --*/
0x00,0xC0,0x78,0x97,0x12,0x10,0xF0,0x00,0x00,0x00,0xFF,0x20,0x40,0x80,0x80,0x00,
0x41,0x20,0x10,0x0B,0x04,0x0B,0x10,0x10,0x20,0x20,0x5F,0x40,0x40,0x41,0x40,0x00,

/*--  文字:  理  --*/
/*--  宋体12;  此字体下对应的点阵为：宽x高=16x16   --*/
0x44,0x44,0xFC,0x44,0x44,0x00,0xFE,0x92,0x92,0xFE,0x92,0x92,0x92,0xFE,0x00,0x00,
0x10,0x10,0x0F,0x08,0x48,0x40,0x45,0x44,0x44,0x7F,0x44,0x44,0x44,0x45,0x40,0x00,

/*--  文字:  器  --*/
/*--  宋体12;  此字体下对应的点阵为：宽x高=16x16   --*/
0x40,0x40,0x4F,0x49,0x49,0xC9,0xCF,0x70,0xC0,0xCF,0x49,0x59,0x69,0x4F,0x00,0x00,
0x02,0x02,0x7E,0x45,0x45,0x44,0x7C,0x00,0x7C,0x44,0x45,0x45,0x7E,0x06,0x02,0x00,

/*--  文字:  是  --*/
/*--  宋体12;  此字体下对应的点阵为：宽x高=16x16   --*/
0x80,0x80,0x80,0x80,0xBE,0xAA,0xAA,0xAA,0xAA,0xAA,0xAA,0xBE,0x80,0x80,0x80,0x00,
0x00,0x40,0x20,0x10,0x0E,0x10,0x20,0x3F,0x44,0x44,0x44,0x44,0x44,0x40,0x40,0x00,

/*--  文字:  一  --*/
/*--  宋体12;  此字体下对应的点阵为：宽x高=16x16   --*/
0x00,0x80,0x80,0x80,0x80,0x80,0x80,0x80,0x80,0x80,0x80,0x80,0x80,0xC0,0x80,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,

/*--  文字:  种  --*/
/*--  宋体12;  此字体下对应的点阵为：宽x高=16x16   --*/
0x00,0x12,0x12,0xD2,0xFE,0x51,0x81,0xF0,0x10,0x10,0xFF,0x10,0x10,0xF0,0x00,0x00,
0x08,0x04,0x03,0x00,0xFF,0x00,0x00,0x03,0x01,0x01,0xFF,0x01,0x01,0x03,0x00,0x00,

/*--  文字:  特  --*/
/*--  宋体12;  此字体下对应的点阵为：宽x高=16x16   --*/
0x20,0x1C,0x10,0xFF,0x90,0xB0,0x24,0x24,0x24,0x3F,0x24,0xE4,0x24,0x24,0x20,0x00,
0x02,0x02,0x01,0xFF,0x00,0x00,0x01,0x05,0x19,0x41,0x81,0x7F,0x01,0x01,0x01,0x00,

/*--  文字:  别  --*/
/*--  宋体12;  此字体下对应的点阵为：宽x高=16x16   --*/
0x00,0x00,0x7E,0x22,0xE2,0x22,0x22,0x7E,0x00,0x00,0xFC,0x00,0x00,0xFF,0x00,0x00,
0x80,0x41,0x31,0x0D,0x03,0x21,0x61,0x3F,0x00,0x00,0x07,0x40,0xC0,0x7F,0x00,0x00,

/*--  文字:  适  --*/
/*--  宋体12;  此字体下对应的点阵为：宽x高=16x16   --*/
0x40,0x41,0xC6,0x00,0x10,0x10,0x92,0x92,0x92,0xFE,0x91,0x91,0x91,0x10,0x10,0x00,
0x40,0x20,0x1F,0x20,0x40,0x40,0x4F,0x48,0x48,0x48,0x48,0x48,0x4F,0x40,0x40,0x00,

/*--  文字:  合  --*/
/*--  宋体12;  此字体下对应的点阵为：宽x高=16x16   --*/
0x40,0x40,0x20,0x50,0x48,0x44,0x42,0x41,0x42,0x44,0x68,0x50,0x30,0x60,0x20,0x00,
0x00,0x00,0x00,0x7E,0x22,0x22,0x22,0x22,0x22,0x22,0x22,0x7E,0x00,0x00,0x00,0x00,

/*--  文字:  于  --*/
/*--  宋体12;  此字体下对应的点阵为：宽x高=16x16   --*/
0x40,0x40,0x42,0x42,0x42,0x42,0x42,0xFE,0x42,0x42,0x42,0x42,0x42,0x42,0x40,0x00,
0x00,0x00,0x00,0x00,0x20,0x40,0x80,0x7F,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,

/*--  文字:  进  --*/
/*--  宋体12;  此字体下对应的点阵为：宽x高=16x16   --*/
0x80,0x82,0x9C,0x88,0x00,0x88,0x88,0xFF,0x88,0x88,0x88,0xFF,0x88,0x88,0x80,0x00,
0x00,0x40,0x20,0x1F,0x20,0x50,0x4C,0x43,0x40,0x40,0x40,0x5F,0x40,0x40,0x40,0x00,

/*--  文字:  行  --*/
/*--  宋体12;  此字体下对应的点阵为：宽x高=16x16   --*/
0x10,0x08,0x84,0xC6,0x73,0x22,0x40,0x44,0x44,0x44,0xC4,0x44,0x44,0x44,0x40,0x00,
0x02,0x01,0x00,0xFF,0x00,0x00,0x00,0x00,0x40,0x80,0x7F,0x00,0x00,0x00,0x00,0x00,

/*--  文字:  数  --*/
/*--  宋体12;  此字体下对应的点阵为：宽x高=16x16   --*/
0x10,0x92,0x54,0x38,0xFF,0x38,0x54,0x52,0x80,0xF0,0x1F,0x12,0x10,0xF0,0x10,0x00,
0x42,0x42,0x2A,0x2E,0x13,0x1A,0x26,0x02,0x40,0x20,0x13,0x0C,0x33,0x60,0x20,0x00,

/*--  文字:  字  --*/
/*--  宋体12;  此字体下对应的点阵为：宽x高=16x16   --*/
0x00,0x10,0x0C,0x24,0x24,0x24,0x25,0x26,0xA4,0x64,0x24,0x04,0x14,0x0C,0x00,0x00,
0x00,0x02,0x02,0x02,0x02,0x42,0x82,0x7F,0x02,0x02,0x02,0x02,0x02,0x02,0x02,0x00,

/*--  文字:  信  --*/
/*--  宋体12;  此字体下对应的点阵为：宽x高=16x16   --*/
0x80,0x40,0x30,0xFC,0x07,0x0A,0xA8,0xA8,0xA9,0xAE,0xAA,0xA8,0xA8,0x08,0x08,0x00,
0x00,0x00,0x00,0x7F,0x00,0x00,0x7E,0x22,0x22,0x22,0x22,0x22,0x7E,0x00,0x00,0x00,

/*--  文字:  号  --*/
/*--  宋体12;  此字体下对应的点阵为：宽x高=16x16   --*/
0x40,0x40,0x40,0x5F,0xD1,0x51,0x51,0x51,0x51,0x51,0x51,0x5F,0x40,0x40,0x40,0x00,
0x00,0x00,0x00,0x02,0x07,0x02,0x02,0x22,0x42,0x82,0x42,0x3E,0x00,0x00,0x00,0x00,

/*--  文字:  处  --*/
/*--  宋体12;  此字体下对应的点阵为：宽x高=16x16   --*/
0x00,0xC0,0x78,0x97,0x12,0x10,0xF0,0x00,0x00,0x00,0xFF,0x20,0x40,0x80,0x80,0x00,
0x41,0x20,0x10,0x0B,0x04,0x0B,0x10,0x10,0x20,0x20,0x5F,0x40,0x40,0x41,0x40,0x00,

/*--  文字:  理  --*/
/*--  宋体12;  此字体下对应的点阵为：宽x高=16x16   --*/
0x44,0x44,0xFC,0x44,0x44,0x00,0xFE,0x92,0x92,0xFE,0x92,0x92,0x92,0xFE,0x00,0x00,
0x10,0x10,0x0F,0x08,0x48,0x40,0x45,0x44,0x44,0x7F,0x44,0x44,0x44,0x45,0x40,0x00,

/*--  文字:  运  --*/
/*--  宋体12;  此字体下对应的点阵为：宽x高=16x16   --*/
0x40,0x41,0xCE,0x04,0x00,0x20,0x22,0xA2,0x62,0x22,0xA2,0x22,0x22,0x22,0x20,0x00,
0x40,0x20,0x1F,0x20,0x28,0x4C,0x4A,0x49,0x48,0x4C,0x44,0x45,0x5E,0x4C,0x40,0x00,

/*--  文字:  算  --*/
/*--  宋体12;  此字体下对应的点阵为：宽x高=16x16   --*/
0x08,0x07,0xFA,0xAA,0xAE,0xAA,0xAA,0xA8,0xAC,0xAB,0xAA,0xFE,0x0A,0x02,0x02,0x00,
0x08,0x08,0x8B,0x6A,0x1E,0x0A,0x0A,0x0A,0x0A,0xFE,0x0A,0x0B,0x08,0x08,0x08,0x00,

/*--  文字:  的  --*/
/*--  宋体12;  此字体下对应的点阵为：宽x高=16x16   --*/
0x00,0xF8,0x8C,0x8B,0x88,0xF8,0x40,0x30,0x8F,0x08,0x08,0x08,0x08,0xF8,0x00,0x00,
0x00,0x7F,0x10,0x10,0x10,0x3F,0x00,0x00,0x00,0x03,0x26,0x40,0x20,0x1F,0x00,0x00,

/*--  文字:  微  --*/
/*--  宋体12;  此字体下对应的点阵为：宽x高=16x16   --*/
0x10,0x88,0xF7,0x22,0x5C,0x50,0x5F,0x50,0x5C,0x20,0xF8,0x17,0x12,0xF0,0x10,0x00,
0x01,0x00,0xFF,0x40,0x20,0x1F,0x01,0x01,0xBF,0x50,0x21,0x16,0x08,0xF7,0x40,0x00,

/*--  文字:  处  --*/
/*--  宋体12;  此字体下对应的点阵为：宽x高=16x16   --*/
0x00,0xC0,0x78,0x97,0x12,0x10,0xF0,0x00,0x00,0x00,0xFF,0x20,0x40,0x80,0x80,0x00,
0x41,0x20,0x10,0x0B,0x04,0x0B,0x10,0x10,0x20,0x20,0x5F,0x40,0x40,0x41,0x40,0x00,

/*--  文字:  理  --*/
/*--  宋体12;  此字体下对应的点阵为：宽x高=16x16   --*/
0x44,0x44,0xFC,0x44,0x44,0x00,0xFE,0x92,0x92,0xFE,0x92,0x92,0x92,0xFE,0x00,0x00,
0x10,0x10,0x0F,0x08,0x48,0x40,0x45,0x44,0x44,0x7F,0x44,0x44,0x44,0x45,0x40,0x00,

/*--  文字:  器  --*/
/*--  宋体12;  此字体下对应的点阵为：宽x高=16x16   --*/
0x40,0x40,0x4F,0x49,0x49,0xC9,0xCF,0x70,0xC0,0xCF,0x49,0x59,0x69,0x4F,0x00,0x00,
0x02,0x02,0x7E,0x45,0x45,0x44,0x7C,0x00,0x7C,0x44,0x45,0x45,0x7E,0x06,0x02,0x00,

/*--  文字:  ，  --*/
/*--  宋体12;  此字体下对应的点阵为：宽x高=16x16   --*/
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x58,0x38,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,

};

void ReadState (Uint16 flag) //读状态字，判断忙否，flag切换左右屏幕
{
	Uint16	staflag;
	EALLOW;  
	GpioMuxRegs.GPBDIR.all = GpioMuxRegs.GPBDIR.all&0x00ff;//D0~D7输入
    EDIS;
	if(flag==1)
		LCD_CSA	//左屏幕
	else	
		LCD_CSB	//右屏幕
	LCD_RW = 1;//读状态
	LCD_DI = 0;
	
	while(1)
	{		
		LCD_E = 1;
		for(i=0; i<2; i++){}
		LCD_E = 0;
	staflag = GpioDataRegs.GPBDAT.all&0x8000;// 读液晶状态
		if(staflag==0x0000)break;
	}
}


void WriteIns (Uint16 INS,Uint16 flag) //写指令
{
	ReadState (flag);
	EALLOW;  
	GpioMuxRegs.GPBDIR.all = GpioMuxRegs.GPBDIR.all|0xFF00;//D0~D7输出
    EDIS;
	if(flag==1)
		LCD_CSA	//左屏幕
	else	
		LCD_CSB	//右屏幕
	LCD_RW = 0;//写指令
	LCD_DI = 0;
	
    LCD_E = 1;//高电平有效
    GpioDataRegs.GPBDAT.all=INS<<8;       // 指令写入
	for(i=0; i<2; i++){}	
	LCD_E = 0;//下降沿琐存
}

void WriteData (Uint16 DATA,Uint16 Yaddress,Uint16 flag) //写数据子程序
{

	WriteIns(Yaddress,flag);		//设置列地址
	ReadState (flag);				//查询液晶是否为空闲
	EALLOW;  
	GpioMuxRegs.GPBDIR.all = GpioMuxRegs.GPBDIR.all|0xFF00;//D0~D7输出
    EDIS;
    if(flag==1)
		LCD_CSA	//左屏幕
	else	
		LCD_CSB	//右屏幕
	LCD_RW = 0;//写数据
	LCD_DI = 1;
	
	LCD_E = 1;//高电平有效
	GpioDataRegs.GPBDAT.all=DATA<<8;// 数据写入
	for(i=0; i<2; i++){}
	LCD_E = 0;//下降沿琐存	
}

void OpenDis (Uint16 flag) //开显示
{
	Uint16	staflag;
	while(1)
	{
		WriteIns (0x3F,flag);	//写开显示指令：LCD显示RAM中的内容
      	ReadState (flag);		//查询液晶是否为空闲 
    	if(flag==1)
			LCD_CSA	//左屏幕
		else	
			LCD_CSB	//右屏幕
		LCD_RW = 1;//读状态
		LCD_DI = 0;
		
		LCD_E = 1;
		for(i=0; i<2; i++){}
		LCD_E = 0;
		staflag = GpioDataRegs.GPBDAT.all&0X2000;// 读液晶状态	
		if(staflag==0x0000)break;  //如果液晶被打开,则退出循环
	}
}

void LCDinit (Uint16 flag) // LCD初始化子程序
{		
	Uint16 pagenum;          //页地址B8~BF
	Uint16 Yaddress;   // Y地址40~7F	      
	for (pagenum=0xB8; pagenum<=0xBF; pagenum++)
    	{
         	WriteIns (pagenum, flag); 		 //设置相应的页地址
        	for (Yaddress=0x40; Yaddress<=0x7F; Yaddress++)
         		{
           			WriteData(0x00, Yaddress, flag);  //送0清屏
          		}
        }  
    OpenDis (flag);			 //开显示
}

void dispString(Uint16 n,Uint16 flag,Uint16 page,Uint16 Yaddress) //送显汉字子程序
{ 
	Uint16 K;
    char temp;
	WriteIns (mov,flag);	//显示起始行设置,改变mov值实现滚屏
   	WriteIns (page,flag);	//设置页
    n=n*32;
    for(K=0;K<16;K++,Yaddress++) 
	    	{
	        	temp=table1[K+n];	//取数据
	        	WriteData (temp,Yaddress,flag);//写数据
	        }
		Yaddress=Yaddress-16;//下半字首列地址
	    page=page+1;	//每页8行,字对应的点阵为：宽x高=16x16 
	    WriteIns (page,flag);//设置下半字页
	    for(;K<32;K++,Yaddress++)
	      	{
	       		temp=table1[K+n];//取数据
	       		WriteData (temp,Yaddress,flag);//写数据
	      	}	
}

main() 
{
     InitSysCtrl();  // 系统初始化
 	DINT;           // 关闭总中断
	IER = 0x0000;   // 关闭外围中断
	IFR = 0x0000;   // 请中断标志	
	IOinit();	    // I/O初始化子程序	
	LCDinit(1);     // LCD初始化子程序
	LCDinit(2);
	LCD_SW = 1;     // 开背光
//	mov=0xc0;//显示起始行设置初值(0行)
	
while(1)
	{
	 	
	dispString (0,1,0xb8,0x40);//数
    dispString (1,1,0xb8,0x50);//字
    dispString (2,1,0xb8,0x60);//信
    dispString (3,1,0xb8,0x70);//号
	dispString (4,2,0xb8,0x40);//处
    dispString (5,2,0xb8,0x50);//理
    dispString (6,2,0xb8,0x60);//器
    dispString (7,2,0xb8,0x70);//是
    dispString (8,1,0xba,0x40);//一
    dispString (9,1,0xba,0x50);//种
    dispString (0xa,1,0xba,0x60);//特
    dispString (0xb,1,0xba,0x70);//别
   	dispString (0xc,2,0xba,0x40);//适
   	dispString (0xd,2,0xba,0x50);//合
    dispString (0xe,2,0xba,0x60);//于
   	dispString (0xf,2,0xba,0x70);//进
	dispString (0x10,1,0xbc,0x40);//行
    dispString (0x11,1,0xbc,0x50);//数
    dispString (0x12,1,0xbc,0x60);//字
    dispString (0x13,1,0xbc,0x70);//信
	dispString (0x14,2,0xbc,0x40);//号
    dispString (0x15,2,0xbc,0x50);//处
    dispString (0x16,2,0xbc,0x60);//理
    dispString (0x17,2,0xbc,0x70);//运
    dispString (0x18,1,0xbe,0x40);//算
    dispString (0x19,1,0xbe,0x50);//的
    dispString (0x1a,1,0xbe,0x60);//微
    dispString (0x1b,1,0xbe,0x70);//处
   	dispString (0x1c,2,0xbe,0x40);//理
   	dispString (0x1d,2,0xbe,0x50);//器
    dispString (0x1e,2,0xbe,0x60);//,
	for (i=0; i<500000; i++){}  //延时

		mov=mov+16;
		J=J+1;

	if(J>3)
		{
		J=0;
		mov=0xc0;
		}
}
 
}
